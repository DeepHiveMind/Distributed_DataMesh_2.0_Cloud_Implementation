{"paragraphs":[{"text":"%md # Delta Lake Demo","user":"admin","dateUpdated":"2020-05-13T12:15:48+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364696750_1084977556","id":"20200513-121136_351736837","dateCreated":"2020-05-13T12:11:36+0200","dateStarted":"2020-05-13T12:15:48+0200","dateFinished":"2020-05-13T12:15:48+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3396","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Delta Lake Demo</h1>\n</div>"}]}},{"text":"import io.delta.tables._\nval refinedPath = \"s3a://demo-bucket/refined/person\"","user":"admin","dateUpdated":"2020-05-13T11:59:34+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363854238_2104367325","id":"20200513-115734_108744665","dateCreated":"2020-05-13T11:57:34+0200","dateStarted":"2020-05-13T11:59:34+0200","dateFinished":"2020-05-13T11:59:34+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3397"},{"text":"%md ## Load initial data\n","user":"admin","dateUpdated":"2020-05-13T12:15:52+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364713301_384387089","id":"20200513-121153_1872726954","dateCreated":"2020-05-13T12:11:53+0200","dateStarted":"2020-05-13T12:15:52+0200","dateFinished":"2020-05-13T12:15:52+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3398","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Load initial data</h2>\n</div>"}]}},{"title":"Create a set of Persons to insert","text":"val personDF = Seq(\n  (1, \"Peter\", \"Muster\", \"B\"),\n  (2, \"Marry\", \"Scott\", \"A\"),\n  (3, \"Thomas\", \"Muller\", \"B\")\n).toDF(\"id\", \"firstName\", \"lastName\", \"rating\").repartition(1)","user":"admin","dateUpdated":"2020-05-13T11:59:36+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363689627_-440437523","id":"20200513-114027_10199722","dateCreated":"2020-05-13T11:54:49+0200","dateStarted":"2020-05-13T11:59:36+0200","dateFinished":"2020-05-13T11:59:37+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3399"},{"title":"Create a Delta Lake \"table\"","text":"personDF.write\n        .format(\"delta\")\n        .save(refinedPath);","user":"admin","dateUpdated":"2020-05-13T12:12:53+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363735713_-1863376302","id":"20200513-115535_720498898","dateCreated":"2020-05-13T11:55:35+0200","dateStarted":"2020-05-13T11:59:38+0200","dateFinished":"2020-05-13T11:59:47+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3400"},{"title":"Read the data and show","text":"spark.read.format(\"delta\").load(refinedPath).show()","user":"admin","dateUpdated":"2020-05-13T12:13:09+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":85.9896,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363983878_-1896401966","id":"20200513-115943_393886912","dateCreated":"2020-05-13T11:59:43+0200","dateStarted":"2020-05-13T12:02:24+0200","dateFinished":"2020-05-13T12:02:25+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3401"},{"text":"%md ## Create a new data set with one updated person and one new person","user":"admin","dateUpdated":"2020-05-13T12:15:55+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364789643_1247369259","id":"20200513-121309_1966180378","dateCreated":"2020-05-13T12:13:09+0200","dateStarted":"2020-05-13T12:15:55+0200","dateFinished":"2020-05-13T12:15:55+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3402","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Create a new data set with one updated person and one new person</h2>\n</div>"}]}},{"title":"New Data (update 1, insert 4)","text":"val newPersonDF = Seq(\n  (1, \"Peter\", \"Muster\", \"C\"), \n  (2, \"Marry\", \"Scott\", \"A\"),\n  (3, \"Thomas\", \"Muller\", \"B\"),\n  (4, \"Barbara\", \"Muster\", \"A\")\n).toDF(\"id\", \"firstName\", \"lastName\", \"rating\")","user":"admin","dateUpdated":"2020-05-13T12:03:24+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363760987_1356073229","id":"20200513-115600_556263239","dateCreated":"2020-05-13T11:56:00+0200","dateStarted":"2020-05-13T12:03:24+0200","dateFinished":"2020-05-13T12:03:25+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3403"},{"title":"Get reference to Delta Table","text":"val deltaTable = DeltaTable.forPath(spark, refinedPath)","user":"admin","dateUpdated":"2020-05-13T12:14:38+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":126.024,"optionOpen":false}}},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363689628_-1091101346","id":"20200513-114323_551665140","dateCreated":"2020-05-13T11:54:49+0200","dateStarted":"2020-05-13T12:03:27+0200","dateFinished":"2020-05-13T12:03:27+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3404"},{"title":"Merge to existing Delta Table","text":"deltaTable.alias(\"oldData\")\n          .merge(newPersonDF.alias(\"newData\"),\n            \"oldData.id = newData.id\")\n          .whenMatched().updateAll()\n          .whenNotMatched().insertAll()\n          .execute()","user":"admin","dateUpdated":"2020-05-13T12:14:17+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true,"title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589363689629_-989174070","id":"20200513-114144_303323344","dateCreated":"2020-05-13T11:54:49+0200","dateStarted":"2020-05-13T12:03:37+0200","dateFinished":"2020-05-13T12:03:52+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3405"},{"title":"Read and show the new data","text":"spark.read.format(\"delta\").load(refinedPath).show()","user":"admin","dateUpdated":"2020-05-13T12:14:50+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364217454_-1087611033","id":"20200513-120337_910109760","dateCreated":"2020-05-13T12:03:37+0200","dateStarted":"2020-05-13T12:03:49+0200","dateFinished":"2020-05-13T12:03:53+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3406"},{"text":"%md ## Time Travel","user":"admin","dateUpdated":"2020-05-13T12:15:58+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364676150_-1004155083","id":"20200513-121116_662374032","dateCreated":"2020-05-13T12:11:16+0200","dateStarted":"2020-05-13T12:15:58+0200","dateFinished":"2020-05-13T12:15:58+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3407","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Time Travel</h2>\n</div>"}]}},{"title":"Get the full history of the table","text":"val fullHistoryDF = deltaTable.history()    \nfullHistoryDF.show()\n","user":"admin","dateUpdated":"2020-05-13T12:07:50+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364406962_2142808045","id":"20200513-120646_843828523","dateCreated":"2020-05-13T12:06:46+0200","dateStarted":"2020-05-13T12:07:29+0200","dateFinished":"2020-05-13T12:07:30+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3408"},{"title":"Get the last operation","text":"val lastOperationDF = deltaTable.history(1)\nlastOperationDF.show()","user":"admin","dateUpdated":"2020-05-13T12:08:10+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364452448_-1757349697","id":"20200513-120732_304154205","dateCreated":"2020-05-13T12:07:32+0200","dateStarted":"2020-05-13T12:08:10+0200","dateFinished":"2020-05-13T12:08:11+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3409"},{"title":"Show the data for version 0","text":"val firstVersionPersonDF = spark.read.format(\"delta\").option(\"versionAsOf\", 0).load(refinedPath)\nfirstVersionPersonDF.show()","user":"admin","dateUpdated":"2020-05-13T12:15:36+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364479216_-2025410611","id":"20200513-120759_1971946580","dateCreated":"2020-05-13T12:07:59+0200","dateStarted":"2020-05-13T12:15:28+0200","dateFinished":"2020-05-13T12:15:33+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3410"},{"text":"%md ## Vacuum data (only after 7 days)","user":"admin","dateUpdated":"2020-05-13T12:16:01+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364895081_1434671680","id":"20200513-121455_192577569","dateCreated":"2020-05-13T12:14:55+0200","dateStarted":"2020-05-13T12:16:01+0200","dateFinished":"2020-05-13T12:16:01+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3411","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Vacuum data (only after 7 days)</h2>\n</div>"}]}},{"text":"deltaTable.vacuum()","user":"admin","dateUpdated":"2020-05-13T12:04:31+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364229852_-536118960","id":"20200513-120349_198488378","dateCreated":"2020-05-13T12:03:49+0200","dateStarted":"2020-05-13T12:04:31+0200","dateFinished":"2020-05-13T12:05:57+0200","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3412"},{"user":"admin","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589364263584_-595034092","id":"20200513-120423_7282774","dateCreated":"2020-05-13T12:04:23+0200","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3413"}],"name":"Delta Lake Demo","id":"2F8XCPFD6","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}